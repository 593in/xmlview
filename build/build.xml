<?xml version="1.0"?>
<project name="XML View" basedir="../" default="compile">
	<property file="${basedir}/build/build.properties"/>
	<import file="${webtasks.dir}/webtasks.xml"/>
	
	<target name="init">
		<mkdir dir="${dist.dir}"/>
		<mkdir dir="${dist.css.dir}"/>
		<mkdir dir="${dist.css-full.dir}"/>
		<mkdir dir="${dist.js.dir}"/>
	</target>
	
	<filelist dir="${js-src.dir}" id="js.source">
		<file name="lib/underscore.js"/>
		<file name="lib/js-signals.js"/>
		<file name="signals.js"/>
		<file name="utils.js"/>
		<file name="dom.js"/>
		<file name="settings.js"/>
		<file name="renderer.js"/>
		<file name="search.js"/>
		<file name="search_ui.js"/>
		<file name="controller.js"/>
		<file name="dnd.js"/>
	</filelist>
	
	<target name="compile.js" depends="init">
		<compress-js-lib tofile="${dist.js.dir}/xv.js" force="${force-rebuild}" use-cc="${webtasks.use-cc}">
			<filelist refid="js.source"/>
		</compress-js-lib>
		
		<concat destfile="${dist.js.dir}/xv-src.js">
			<filelist refid="js.source"/>
		</concat>
	</target>
	
	<target name="compile.css" depends="init">
		<cssGlue dir="${css-src.dir}" todir="${dist.css-full.dir}" force="${force-rebuild}"/>
		<compress-css dir="${css-src.dir}" todir="${dist.css.dir}" force="${force-rebuild}"/>
	</target>
	
	<target name="chrome.extension" depends="init" description="Build Google Chrome extension">
		<mkdir dir="${dist.chrome.dir}"/>
		<copy todir="${dist.chrome.dir}">
			<fileset dir="${chrome-src.dir}"/>
		</copy>
		<concat destfile="${dist.chrome.dir}/xv.js">
			<filelist dir="${js-src.dir}">
				<file name="lib/underscore.js"/>
				<file name="lib/js-signals.js"/>
				<file name="signals.js"/>
				<file name="utils.js"/>
				<file name="dom.js"/>
				<file name="settings.js"/>
				<file name="renderer.js"/>
				<file name="search.js"/>
				<file name="dnd.js"/>
				<file name="controller.js"/>
			</filelist>
		</concat>
		<copy file="${js-src.dir}/dnd_feedback.js" todir="${dist.chrome.dir}"/>
	</target>
	
	<target name="compile" depends="compile.css, compile.js, chrome.extension">
		<copy file="${basedir}/xml-pretty-print.xslt" tofile="${dist.dir}/xmlview.xsl"/>
		<echo>Build done</echo>
	</target>
</project>